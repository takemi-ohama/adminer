# 開発AI向け指示書


# 1. テスト基盤の充実
* 現在、e2eテストはdocker exec 経由でテストコンテナ内のcurlを実行していますが、dev環境側にplaywrightとplaywright mcpを導入してテストをブラウザベースで実効できるようにします。

* container/tests/Dockerfileや.mcp.jsonにこれらのツールを導入してください。

# 2. e2eテスト整備続き
* e2eコンテナで実行しているplaywriteの画面をdevコンテナに接続されているvscode上で表示できるように設定してください

# 3. playwrite mcpでのテスト
* playwrite mcpを使ってwebコンテナのadminer bigquery pluginの問題点を洗い出してください。
* container/docs/を読んでテスト手順を確認してください。この開発環境はdood形式なので、http://[コンテナ名]で接続する必要があります。
* adminerコンテナの動作が遅いので、タイムアウトは20秒としてください。
* 既知の問題点は以下のようなものがあります。
    * playwriteで日本語が文字化けする(contaner/dev/Dockerfile で適切なfontsをインストールする)
    * テーブル構造の表示の際、type情報が全てnullになっている
    * select dataでデータを表示できない
* 既知の問題や新たに発見した問題も含め、改善レポートをcontainer/issues/report03.mdにまとめてください

# 4. 高速化のためのアイデア
* 現行のbigquery pluginはかなり全体的なパフォーマンスに難があり、データベースやテーブルの一覧、データの表示などが遅いです。
* コードと利用しているbigqueryコネクタを解析し、高速化のためのアイデアを出してcontainer/issues/report04.mdにまとめてください
* 以下の観点や、一般的なアイデアから検討してください。
    * どの処理が遅いか、の計測
    * できるだけまとめて取得(N+1にならないようにする)
    * より高速に実行できるコーディング(ループ処理や分岐処理の改善)
    * コネクタやオブジェクトの再利用
    * キャッシュ機構の導入
    * プリロード
    * 別のbigqueryコネクタの利用
    * APIやbqの直接利用

# 5. 高速化実装
container/issues/report04.md を参考に高速化を実行してください

# 6. 計測
* 実装されたProfilerを利用して、どの処理に時間が掛っているかを計測し、container/issues/report05.md で報告してください。

# 7. ボトルネック解消
* 手元のブラウザではあまり効果がなく、全体的に遅いように感じます。
* container/issues/report05.md でボトルネックと報告されているBigQuery API接続確立を高速化する方法について検討し実装してください。

# 8. apcu警告の対応
* container/issues/report06.md に基づいてapcuをstub登録してください
