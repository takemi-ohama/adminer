# 開発AI向け指示書


# 1. ワークスペースの全体像の把握
* 回答やレポートは全て日本語で出力してください。
* このワークスペースはadminerをforkしたリポジトリで構成されています
* まずファイル全体を概観し、全体像を把握して下さい
* このプロジェクトでは、第一弾の目的として、bigqueryに接続するdriverプラグインを開発します
    * issues/report01.md を読み、実装方針を把握してください
    * さらにこの目的に必要な情報を収集してください
* 把握した結果をCLAUDE.mdとSerena MCPに記憶してください
* bigquery driver pluginの開発計画を作成し、issues/plan01.mdに出力してください

# 2. 開発用コンテナに必要なツールを追加
* 開発用のコンテナ(この環境)はcontainer/Dockerfileに定義されています。
* PHPなど、bigquery driver pluginの開発に必要なツールのインストール手順をこのDockerファイルに追加してください

# 3. 実装開始
* issues/plan01.md に従って実装を開始してください

# 4. e2eテスト用コンテナを作成してください。
* 実装されたbigquery pluginを使ったadminerコンテナによるe2eテストを実施するためのコンテナイメージを作成します。
* テスト用コンテナの定義、設定はcontainer/testsに作成します。
* この環境はcontainer/devで定義されているコンテナ上で動作しています
* コンテナ間接続はDooD方式となっており、起動されたコンテナにブラウザやcurl等で接続する場合はhttp://localhostではなく、http://adminer-bigquery-test:80で接続することに注意してください。
* 同様にDooD形式ですので、google_credentialの場所に注意してください
    * claudeが稼働しているのは`adminer-dev-1`コンテナで、credentialは`/etc/google_credentials.json`にあります
    * 新しくコンテナを作成する場合、ホスト側のcredentialは`~/google_credential.json`に存在します。これはclaude codeが稼働しているコンテナから見ることはできません。適切にvolume mountして利用してください。
* コンテナは既存のadminer-netネットワークにexternalで所属させてください。
* bigqueryのプロジェクトはnyle-carmo-analysisです。
* adminer/の他、plugins/やvendor/もDockerfileでcopyしてください。
* customのindex.phpなど、コンテナに必要なファイルはcontainer/tests/においてください。

# 5. e2eテスト実行
* 起動したコンテナを使って動作確認を行ってください。
* できたこと、できなかったことを報告してください。

# 6. 認証関連の修正
* bigqueryはユーザ名とパスワードではなく、credentialを読み込むことでログインします。
* 認証関連についてはplugins/login-password-less.phpやplugins/login-servers.php、plugins/login-table.phpを参考にしてください。
* ログイン画面を修正し、データベース種類とサーバー(プロジェクトIDを入力)、パスワード(credentialを入力)するようにしてください。
    * ユーザ名とデータベースの入力欄は画面から削除し、なくても問題ないようにindex.phpおよびプラグインを修正してください。
* ログイン後、それらの情報を使ってbigqueryに接続し、次の画面へと進んでください。

# 7. 再実装方針の策定
* 認証関連でエラーが続いているのでbigqueryドライバをテストしながら再実装します。
* containers/testsでのコンテナイメージで動作する前提で開発してください。
* issues/report01.md、issues/report01.mdを読み込み、テストと認証関連の再実装手順をまとめます。
* serena mcpを用いて、必要なコード情報を記憶します。
    * 特にadminer本体の認証部分や、オーバーロードの方法などをplugins/の他のモジュールでの実装方法を記憶してください。
* issues/plan02.mdに、実装方針をまとめてください。

# 8. 実装方針に基づく文書化
* 実装方針に基づいて以下のドキュメントを作成してcontainer/docs/ディレクトリにおいてください。それぞれの項目で1つづつでファイルを作成してください。
    * bigqueryドライバ開発ガイドライン
    * bigqueryドライバの設定・利用方法(ユーザ向け)
    * bigqueryドライバを利用したコンテナ作成方法
    * bigqueryドライバコンテナの設定手順と起動方法
    * bigqueryドライバコンテナの設定・利用方法(ユーザ向け)

# 9. 文書追加
* もう一つ文書を作成してcontainer/docs/においてください。
    * DooD環境でのテストコンテナ操作手順

# 10. plan02.mdの見直し
* これまでの分析結果をserena mcpに記憶してください
* 分析結果やドキュメントをもとにissues/plan02.mdを見直し、より詳細に書き直してください

# 11. plan02.mdに基づく実装とテスト
* issues/plan02.md に基づいて実装とテストを進めてください。
* コンテナで起動したadminerで`nyle-carmo-analysis.prod_carmo_db.member_info`テーブルのデータが閲覧できるところまで修正・テストを繰り返してください。
